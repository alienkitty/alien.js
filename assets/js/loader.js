// 2022-01-18 6:30pm
class Device{static agent=navigator.userAgent.toLowerCase();static mobile=!!navigator.maxTouchPoints;static tablet=this.mobile&&Math.max(window.innerWidth,window.innerHeight)>1e3;static phone=this.mobile&&!this.tablet;static webgl=(()=>{if("undefined"==typeof window)return;let t=document.createElement("canvas"),e=t.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});const s=!!e;return e=null,t=null,s})()}class Events{static STATE_CHANGE="state_change";static KEY_DOWN="key_down";static KEY_UP="key_up";static KEY_PRESS="key_press";static RESIZE="resize";static VISIBILITY="visibility";static PROGRESS="progress";static COMPLETE="complete";static UPDATE="update";static HOVER="hover";static CLICK="click"}class Assets{static path="";static crossOrigin;static options;static cache=!1;static files={};static add(t,e){this.cache&&(this.files[t]=e)}static get(t){if(this.cache)return this.files[t]}static remove(t){delete this.files[t]}static clear(){this.files={}}static filter(t){return Object.keys(this.files).filter(t).reduce(((t,e)=>(t[e]=this.files[e],t)),{})}static getPath(t){return t.includes("//")||this.path&&!t.includes(this.path)&&(t=this.path+t),t}static loadImage(t,e){const s=new Image;s.crossOrigin=this.crossOrigin,s.src=this.getPath(t);const i=new Promise(((t,e)=>{s.onload=()=>{t(s),s.onload=null},s.onerror=t=>{e(t),s.onerror=null}}));return e&&i.then(e),i}}class EventEmitter{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}off(t,e){if(this.callbacks[t])if(e){const s=this.callbacks[t].indexOf(e);~s&&this.callbacks[t].splice(s,1)}else delete this.callbacks[t]}emit(t,e={}){if(!this.callbacks[t])return;const s=this.callbacks[t].slice();for(let t=0,i=s.length;t<i;t++)s[t].call(this,e)}destroy(){for(const t in this)this[t]=null;return null}}const NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=.1,float32ArraySupported="function"==typeof Float32Array;function A(t,e){return 1-3*e+3*t}function B(t,e){return 3*e-6*t}function C(t){return 3*t}function calcBezier(t,e,s){return((A(e,s)*t+B(e,s))*t+C(e))*t}function getSlope(t,e,s){return 3*A(e,s)*t*t+2*B(e,s)*t+C(e)}function binarySubdivide(t,e,s,i,n){let a,r,o=0;do{r=e+(s-e)/2,a=calcBezier(r,i,n)-t,a>0?s=r:e=r}while(Math.abs(a)>1e-7&&++o<10);return r}function newtonRaphsonIterate(t,e,s,i){for(let n=0;n<4;n++){const n=getSlope(e,s,i);if(0===n)return e;e-=(calcBezier(e,s,i)-t)/n}return e}function LinearEasing(t){return t}function bezier(t,e,s,i){if(!(0<=t&&t<=1&&0<=s&&s<=1))throw new Error("Bezier x values must be in [0, 1] range");if(t===e&&s===i)return LinearEasing;const n=float32ArraySupported?new Float32Array(11):new Array(11);for(let e=0;e<11;e++)n[e]=calcBezier(.1*e,t,s);return function BezierEasing(a){return 0===a||1===a?a:calcBezier(function getTForX(e){let i=0,a=1;for(;10!==a&&n[a]<=e;a++)i+=.1;a--;const r=i+(e-n[a])/(n[a+1]-n[a])*.1,o=getSlope(r,t,s);return o>=.001?newtonRaphsonIterate(e,r,t,s):0===o?r:binarySubdivide(e,i,i+.1,t,s)}(a),e,i)}}class Easing{static linear(t){return t}static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return--t*t*t+1}static easeInOutCubic(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1- --t*t*t*t}static easeInOutQuart(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}static easeInQuint(t){return t*t*t*t*t}static easeOutQuint(t){return--t*t*t*t*t+1}static easeInOutQuint(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}static easeInSine(t){return 1-Math.sin((1-t)*Math.PI/2)}static easeOutSine(t){return Math.sin(t*Math.PI/2)}static easeInOutSine(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}static easeInExpo(t){return 0===t?0:Math.pow(1024,t-1)}static easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}static easeInOutExpo(t){return 0===t||1===t?t:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}static easeInCirc(t){return 1-Math.sqrt(1-t*t)}static easeOutCirc(t){return Math.sqrt(1- --t*t)}static easeInOutCirc(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static easeInBack(t){const e=1.70158;return 1===t?1:t*t*((e+1)*t-e)}static easeOutBack(t){const e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1}static easeInOutBack(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}static easeInElastic(t,e=1,s=.3){if(0===t||1===t)return t;const i=2*Math.PI,n=s/i*Math.asin(1/e);return-e*Math.pow(2,10*--t)*Math.sin((t-n)*i/s)}static easeOutElastic(t,e=1,s=.3){if(0===t||1===t)return t;const i=2*Math.PI,n=s/i*Math.asin(1/e);return e*Math.pow(2,-10*t)*Math.sin((t-n)*i/s)+1}static easeInOutElastic(t,e=1,s=.3*1.5){if(0===t||1===t)return t;const i=2*Math.PI,n=s/i*Math.asin(1/e);return(t*=2)<1?e*Math.pow(2,10*--t)*Math.sin((t-n)*i/s)*-.5:e*Math.pow(2,-10*--t)*Math.sin((t-n)*i/s)*.5+1}static easeInBounce(t){return 1-this.easeOutBounce(1-t)}static easeOutBounce(t){const e=7.5625,s=2.75;return t<1/s?e*t*t:t<2/s?e*(t-=1.5/s)*t+.75:t<2.5/s?e*(t-=2.25/s)*t+.9375:e*(t-=2.625/s)*t+.984375}static easeInOutBounce(t){return t<.5?.5*this.easeInBounce(2*t):.5*this.easeOutBounce(2*t-1)+.5}static addBezier(t,e,s,i,n){this[t]=bezier(e,s,i,n)}}var RequestFrame,CancelFrame;if("undefined"!=typeof window)RequestFrame=window.requestAnimationFrame,CancelFrame=window.cancelAnimationFrame;else{const t=performance.now(),e=1e3/60;RequestFrame=s=>setTimeout((()=>s(performance.now()-t)),e),CancelFrame=clearTimeout}class Ticker{constructor(){this.callbacks=[],this.last=performance.now(),this.time=0,this.delta=0,this.frame=0,this.isAnimating=!1,this.start()}onTick=t=>{this.isAnimating&&(this.requestId=RequestFrame(this.onTick)),this.delta=Math.min(150,t-this.last),this.last=t,this.time=.001*t,this.frame++;for(let e=this.callbacks.length-1;e>=0;e--){const s=this.callbacks[e];if(s)if(s.fps){const e=t-s.last;if(e<1e3/s.fps)continue;s.last=t,s.frame++,s(this.time,e,s.frame)}else s(this.time,this.delta,this.frame)}};add(t,e){e&&(t.fps=e,t.last=performance.now(),t.frame=0),this.callbacks.unshift(t)}remove(t){const e=this.callbacks.indexOf(t);~e&&this.callbacks.splice(e,1)}start(){this.isAnimating||(this.isAnimating=!0,this.requestId=RequestFrame(this.onTick))}stop(){this.isAnimating&&(this.isAnimating=!1,CancelFrame(this.requestId))}setRequestFrame(t){RequestFrame=t}setCancelFrame(t){CancelFrame=t}}const ticker=new Ticker,Tweens=[];class Tween{constructor(t,e,s,i,n=0,a,r){"number"!=typeof n&&(r=a,a=n,n=0),this.object=t,this.duration=s,this.elapsed=0,this.ease="function"==typeof i?i:Easing[i]||Easing.easeOutCubic,this.delay=n,this.complete=a,this.update=r,this.isAnimating=!1,this.from={},this.to=Object.assign({},e),this.spring=this.to.spring,this.damping=this.to.damping,delete this.to.spring,delete this.to.damping;for(const e in this.to)"number"==typeof this.to[e]&&"number"==typeof t[e]&&(this.from[e]=t[e]);this.start()}onUpdate=(t,e)=>{this.elapsed+=e;const s=Math.max(0,Math.min(1,(this.elapsed-this.delay)/this.duration)),i=this.ease(s,this.spring,this.damping);for(const t in this.from)this.object[t]=this.from[t]+(this.to[t]-this.from[t])*i;this.update&&this.update(),1===s&&(clearTween(this),this.complete&&this.complete())};start(){this.isAnimating||(this.isAnimating=!0,ticker.add(this.onUpdate))}stop(){this.isAnimating&&(this.isAnimating=!1,ticker.remove(this.onUpdate))}}function delayedCall(t,e){const s=new Tween(e,null,t,"linear",0,e);return Tweens.push(s),s}function wait(t=0){return new Promise((e=>delayedCall(t,e)))}function tween(t,e,s,i,n=0,a,r){"number"!=typeof n&&(r=a,a=n,n=0);const o=new Promise((a=>{const o=new Tween(t,e,s,i,n,a,r);Tweens.push(o)}));return a&&o.then(a),o}function clearTween(t){if(t instanceof Tween){t.stop();const e=Tweens.indexOf(t);~e&&Tweens.splice(e,1)}else for(let e=Tweens.length-1;e>=0;e--)Tweens[e].object===t&&clearTween(Tweens[e])}const Transforms=["x","y","z","skewX","skewY","rotation","rotationX","rotationY","rotationZ","scale","scaleX","scaleY","scaleZ"],Filters=["blur","brightness","contrast","grayscale","hue","invert","saturate","sepia"],Numeric=["opacity","zIndex","fontWeight","strokeWidth","strokeDashoffset","stopOpacity"],Lacuna1=["opacity","brightness","contrast","saturate","scale","stopOpacity"];class Interface{constructor(t,e="div",s){this.events=new EventEmitter,this.children=[],this.timeouts=[],this.style={},this.isTransform=!1,this.isFilter=!1,"object"==typeof t&&null!==t?this.element=t:(this.name=t,this.type=e,this.element="svg"===e?document.createElementNS("http://www.w3.org/2000/svg",s||"svg"):document.createElement(e),"string"==typeof t&&("."===t.charAt(0)?this.element.className=t.substr(1):this.element.id=t)),this.element.object=this}add(t){if(this.children)return t.destroy&&(this.children.push(t),t.parent=this),t.element?this.element.appendChild(t.element):t.nodeName&&this.element.appendChild(t),t}remove(t){if(!this.children)return;t.element?t.element.parentNode.removeChild(t.element):t.nodeName&&t.parentNode.removeChild(t);const e=this.children.indexOf(t);~e&&this.children.splice(e,1)}clone(){if(this.element)return new Interface(this.element.cloneNode(!0))}empty(){if(this.element){for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();return this.children.length=0,this.element.innerHTML="",this}}attr(t){if(this.element){for(const e in t)this.element.setAttribute(e,t[e]);return this}}css(t){if(!this.element)return;const e=this.style;for(const s in t){if(~Transforms.indexOf(s)){e[s]=t[s],this.isTransform=!0;continue}if(~Filters.indexOf(s)){e[s]=t[s],this.isFilter=!0;continue}let i;~Numeric.indexOf(s)?(i=t[s],e[s]=i):i="string"!=typeof t[s]?t[s]+"px":t[s],this.element.style[s]=i}if(this.isTransform){let t="";if(void 0!==e.x||void 0!==e.y||void 0!==e.z){t+=`translate3d(${void 0!==e.x?e.x:0}px, ${void 0!==e.y?e.y:0}px, ${void 0!==e.z?e.z:0}px)`}void 0!==e.skewX&&(t+=`skewX(${e.skewX}deg)`),void 0!==e.skewY&&(t+=`skewY(${e.skewY}deg)`),void 0!==e.rotation&&(t+=`rotate(${e.rotation}deg)`),void 0!==e.rotationX&&(t+=`rotateX(${e.rotationX}deg)`),void 0!==e.rotationY&&(t+=`rotateY(${e.rotationY}deg)`),void 0!==e.rotationZ&&(t+=`rotateZ(${e.rotationZ}deg)`),void 0!==e.scale&&(t+=`scale(${e.scale})`),void 0!==e.scaleX&&(t+=`scaleX(${e.scaleX})`),void 0!==e.scaleY&&(t+=`scaleY(${e.scaleY})`),void 0!==e.scaleZ&&(t+=`scaleZ(${e.scaleZ})`),this.element.style.transform=t}if(this.isFilter){let t="";void 0!==e.blur&&(t+=`blur(${e.blur}px)`),void 0!==e.brightness&&(t+=`brightness(${e.brightness})`),void 0!==e.contrast&&(t+=`contrast(${e.contrast})`),void 0!==e.grayscale&&(t+=`grayscale(${e.grayscale})`),void 0!==e.hue&&(t+=`hue-rotate(${e.hue}deg)`),void 0!==e.invert&&(t+=`invert(${e.invert})`),void 0!==e.saturate&&(t+=`saturate(${e.saturate})`),void 0!==e.sepia&&(t+=`sepia(${e.sepia})`),this.element.style.filter=t}return this}tween(t,e,s,i=0,n,a){if(!this.element)return;"number"!=typeof i&&(a=n,n=i,i=0);const r=getComputedStyle(this.element);for(const e in t){let t;void 0!==this.style[e]?t=this.style[e]:~Transforms.indexOf(e)||~Filters.indexOf(e)||~Numeric.indexOf(e)?t=~Lacuna1.indexOf(e)?1:0:"string"==typeof r[e]&&(t=parseFloat(r[e])),isNaN(t)||(this.style[e]=t)}return tween(this.style,t,e,s,i,n,(()=>{this.css(this.style),a&&a()}))}clearTween(){return clearTween(this.style),this}delayedCall(t,e){if(!this.timeouts)return;const s=delayedCall(t,(()=>{this.clearTimeout(s,!0),e&&e()}));return this.timeouts.push(s),s}clearTimeout(t,e){if(!this.timeouts)return;e||clearTween(t);const s=this.timeouts.indexOf(t);~s&&this.timeouts.splice(s,1)}clearTimeouts(){if(this.timeouts)for(let t=this.timeouts.length-1;t>=0;t--)this.clearTimeout(this.timeouts[t])}text(t){if(this.element)return void 0===t?this.element.textContent:(this.element.textContent=t,this)}html(t){if(this.element)return void 0===t?this.element.innerHTML:(this.element.innerHTML=t,this)}hide(){return this.css({display:"none"})}show(){return this.css({display:""})}invisible(){return this.css({visibility:"hidden"})}visible(){return this.css({visibility:""})}bg(t,e="contain",s="center",i="no-repeat"){const n={backgroundImage:`url(${t=Assets.getPath(t)})`,backgroundSize:e,backgroundPosition:s,backgroundRepeat:i};return this.css(n)}line(t=this.progress||0){const e=this.start||0,s=this.offset||0,i=this.element.getTotalLength(),n=i*t,a={strokeDasharray:`${n},${i-n}`,strokeDashoffset:-i*(e+s)};return this.css(a)}load(t){t=Assets.getPath(t);return fetch(t,Assets.options).then((t=>t.text())).then((t=>{this.html(t)}))}destroy(){if(this.children){this.parent&&this.parent.remove&&this.parent.remove(this),this.clearTimeouts(),this.clearTween(),this.events.destroy();for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();this.element.object=null;for(const t in this)this[t]=null;return null}}}var Stage,AudioContext;if("undefined"!=typeof window){function onPopState(t){Stage.path=location.pathname,Stage.events.emit(Events.STATE_CHANGE,t)}function onKeyDown(t){Stage.events.emit(Events.KEY_DOWN,t)}function onKeyUp(t){Stage.events.emit(Events.KEY_UP,t)}function onKeyPress(t){Stage.events.emit(Events.KEY_PRESS,t)}function onResize(t){Stage.width=window.innerWidth,Stage.height=window.innerHeight,Stage.dpr=window.devicePixelRatio,Stage.aspect=Stage.width/Stage.height,Stage.events.emit(Events.RESIZE,t)}function onVisibility(t){Stage.events.emit(Events.VISIBILITY,t)}(Stage=new Interface(document.querySelector("#root"))).root=document.querySelector(":root"),Stage.rootStyle=getComputedStyle(Stage.root),window.addEventListener("popstate",onPopState),window.addEventListener("keydown",onKeyDown),window.addEventListener("keyup",onKeyUp),window.addEventListener("keypress",onKeyPress),window.addEventListener("resize",onResize),document.addEventListener("visibilitychange",onVisibility),onResize(),Stage.setPath=t=>{history.pushState(null,null,t),onPopState()}}class Loader{constructor(t=[],e){this.events=new EventEmitter,this.total=0,this.loaded=0,this.progress=0,this.promise=new Promise((t=>this.resolve=t)),this.assets=t,this.callback=e,t.forEach((t=>this.load(t)))}load(){}loadAsync(t){return new Promise((e=>this.load(t,e)))}increment(){this.progress=++this.loaded/this.total,this.events.emit(Events.PROGRESS,{progress:this.progress}),this.loaded===this.total&&this.complete()}complete(){this.resolve(),this.events.emit(Events.COMPLETE),this.callback&&this.callback()}add(t=1){this.total+=t}trigger(t=1){for(let e=0;e<t;e++)this.increment()}ready(){return this.total?this.promise:Promise.resolve()}destroy(){this.events.destroy();for(const t in this)this[t]=null;return null}}class AssetLoader extends Loader{static loadAssets(t,e){const s=new Promise((e=>new AssetLoader(t,e)));return e&&s.then(e),s}load(t,e){t=Assets.getPath(t);const s=Assets.get(t);let i;i=s?Promise.resolve(s):/\.(jpe?g|png|gif|svg)/.test(t)?Assets.loadImage(t):fetch(t,Assets.options).then((e=>/\.(mp3|m4a|ogg|wav|aiff?)/.test(t)?e.arrayBuffer():/\.json/.test(t)?e.json():e.text())),i.then((s=>{Assets.add(t,s),this.increment(),e&&e(s)})).catch((t=>{this.increment(),e&&e(t)})),this.total++}}class FontLoader extends Loader{static loadFonts(t,e){const s=new Promise((e=>new FontLoader(t,e)));return e&&s.then(e),s}load(t,e){"object"!=typeof t&&(t={style:"normal",variant:"normal",weight:"normal",family:t.replace(/"/g,"'")});const s=(({style:t="normal",variant:e="normal",weight:s="normal",family:i})=>`${t} ${e} ${s} 12px "${i}"`)(t);let i=document.createElement("canvas"),n=i.getContext("2d");document.fonts.load(s).then((t=>(n.font=s,n.fillText("LOAD",0,0),t))).then((t=>{this.increment(),e&&e(t)})).catch((t=>{this.increment(),e&&e(t)})).finally((()=>{n=null,i=null})),this.total++}}class MultiLoader extends Loader{constructor(){super(),this.loaders=[],this.weights=[]}load(t,e=1){t.events.on(Events.PROGRESS,this.onProgress),t.events.on(Events.COMPLETE,this.onComplete),this.loaders.push(t),this.weights.push(e),this.total+=e}onProgress=()=>{let t=this.loaded;for(let e=0,s=this.loaders.length;e<s;e++)t+=this.weights[e]*this.loaders[e].progress;const e=t/this.total;e<1&&this.events.emit(Events.PROGRESS,{progress:e})};onComplete=()=>{this.increment()};destroy=()=>{for(let t=this.loaders.length-1;t>=0;t--)this.loaders[t]&&this.loaders[t].destroy&&this.loaders[t].destroy();return super.destroy()}}function radians(t){return t*Math.PI/180}function clamp(t,e,s){return Math.max(e,Math.min(s,t))}function shuffle(t){return t.sort((()=>Math.random()-.5))}function basename(t,e){const s=t.split("/").pop().split("?")[0];return e?s:s.split(".")[0]}class WebAudioParam{constructor(t,e,s,i){this.parent=t,this.node=e,this.param=s,this.alpha=i,this.parent[this.node]&&(this.parent[this.node][this.param].cancelScheduledValues(this.parent.context.currentTime),this.parent[this.node][this.param].setValueAtTime(this.alpha,this.parent.context.currentTime))}get value(){return this.alpha}set value(t){this.alpha!==t&&(this.parent[this.node]&&(this.parent[this.node][this.param].cancelScheduledValues(this.parent.context.currentTime),this.parent[this.node][this.param].setTargetAtTime(t,this.parent.context.currentTime,.1)),this.alpha=t)}fade(t,e){this.parent[this.node]&&(this.parent[this.node][this.param].cancelScheduledValues(this.parent.context.currentTime),this.parent[this.node][this.param].setTargetAtTime(t,this.parent.context.currentTime,.001*e))}}class Sound{constructor(t,e,s,i){this.parent=t,this.context=t.context,this.id=e,this.buffer=s,this.loop=!1,this.playing=!1,this.stopping=!1,this.output=this.context.createGain(),this.output.connect(t.input),i||(this.stereo=this.context.createStereoPanner(),this.stereo.connect(this.output)),this.gain=new WebAudioParam(this,"output","gain",0),this.stereoPan=new WebAudioParam(this,"stereo","pan",0),this.playbackRate=new WebAudioParam(this,"source","playbackRate",1),this.input=this.stereo||this.output,Device.mobile&&"running"!==this.context.state||this.load()}load(){if(this.buffer instanceof ArrayBuffer){const t=new Promise(((t,e)=>{this.context.decodeAudioData(this.buffer.slice(),(e=>t(e)),e)})).then((t=>{this.buffer=t}));this.ready=()=>t}else this.ready=()=>Promise.resolve()}play(){this.ready||this.load(),this.context.resume().then(this.ready).then((()=>{if(this.output){if(this.output.gain.cancelScheduledValues(this.context.currentTime),this.output.gain.setValueAtTime(this.gain.value,this.context.currentTime),this.stereo&&(this.stereo.pan.cancelScheduledValues(this.context.currentTime),this.stereo.pan.setValueAtTime(this.stereoPan.value,this.context.currentTime)),this.element)this.element.loop=this.loop,this.element.play();else{if(this.stopping&&this.loop)return void(this.stopping=!1);this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=this.loop,this.source.playbackRate.cancelScheduledValues(this.context.currentTime),this.source.playbackRate.setValueAtTime(this.playbackRate.value,this.context.currentTime),this.source.connect(this.input),this.source.start()}this.playing=!0}}))}stop(){this.element?this.element.pause():this.source&&this.source.stop(),this.playing=!1}destroy(){this.element?(this.element.pause(),this.element.src="",this.source.disconnect()):this.source&&(this.source.stop(),this.source.buffer=null,this.source.disconnect());for(const t in this)this[t]=null;return null}}"undefined"!=typeof window&&(AudioContext=window.AudioContext);class WebAudio{static context=AudioContext?new AudioContext:null;static init(t={}){if(this.context){this.sounds={},this.output=this.context.createGain(),this.output.connect(this.context.destination),this.gain=new WebAudioParam(this,"output","gain",1),this.input=this.output;for(const e in t)this.add(this,basename(e),t[e])}}static add(t,e,s,i){if(!this.context)return;let n;if("string"==typeof t&&(i=s,s=e,e=t,t=this),"string"==typeof s){n=new Sound(t,e,null,i);const a=new Audio;a.crossOrigin=Assets.crossOrigin,a.autoplay=!1,a.loop=n.loop,a.src=Assets.getPath(s),n.source=this.context.createMediaElementSource(a),n.source.connect(n.input),n.element=a}else n=new Sound(t,e,s,i);return this.sounds[e]=n,n}static remove(t){if(!this.context)return;const e=this.sounds[t];e&&e.destroy(),delete this.sounds[t]}static clone(t,e,s,i){if(!this.context)return;"string"==typeof t&&(i=s,s=e,e=t,t=this);const n=this.sounds[e];return n?this.add(t,s,n.buffer,i):n}static trigger(t){if(!this.context)return;const e=this.sounds[t];return e&&e.play(),e}static play(t,e=1,s){if(!this.context)return;"number"!=typeof e&&(s=e,e=1);const i=this.sounds[t];return i&&(i.gain.alpha=e,i.loop=!!s,this.trigger(t)),i}static fadeInAndPlay(t,e,s,i,n,a=0,r,o){if(!this.context)return;"number"!=typeof a&&(o=r,r=a,a=0);const h=this.sounds[t];return h&&(h.gain.alpha=0,h.loop=!!s,this.trigger(t),h.ready().then((()=>{tween(h.gain,{value:e},i,n,a,r,o)}))),h}static fadeOutAndStop(t,e,s,i=0,n,a){if(!this.context)return;"number"!=typeof i&&(a=n,n=i,i=0);const r=this.sounds[t];return r&&(r.ready().then((()=>{tween(r.gain,{value:0},e,s,i,(()=>{r.stopping&&(r.stopping=!1,r.stop(),n&&n())}),a)})),r.stopping=!0),r}static mute(){this.context&&this.gain.fade(0,300)}static unmute(){this.context&&this.gain.fade(1,500)}static resume(){this.context&&this.context.resume()}static destroy(){if(this.context){for(const t in this.sounds)this.sounds[t]&&this.sounds[t].destroy&&this.sounds[t].destroy();this.context.close();for(const t in this)this[t]=null;return null}}}class Config{static BREAKPOINT=1e3;static ASSETS=["assets/sounds/bass_drum.mp3","assets/sounds/deep_spacy_loop.mp3","assets/sounds/water_loop.mp3"]}class Global{static NUM_POINTERS=22;static USERS=[];static SOUND=!0;static DETAILS_OPEN=!1;static NICKNAME=""}class Socket extends EventEmitter{constructor(){super(),this.views=[],this.views[2]=new DataView(new ArrayBuffer(12)),this.views[3]=new DataView(new ArrayBuffer(11)),this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.connected=!1}init(){this.server="wss://multiuser-fluid.glitch.me",this.connect()}addListeners(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage),this.on("users",this.onUsers),this.on("heartbeat",this.onHeartbeat)}ip2long(t){let e=0;return t.split(".").forEach((t=>{e<<=8,e+=parseInt(t,10)})),e>>>0}long2ip(t){return`${t>>>24}.${t>>16&255}.${t>>8&255}.${255&t}`}onClose=()=>{this.connected=!1,clearTween(this.timeout),this.timeout=delayedCall(250,this.connect)};onMessage=({data:t})=>{switch((t=new DataView(t)).getUint8(0)){case 0:{const e=[],s=17;let i=1;for(let n=0,a=(t.byteLength-1)/s;n<a;n++){const n=t.getUint8(i).toString(),a=this.decoder.decode(t.buffer.slice(i+1,i+11)).replace(/\0/g,""),r=this.long2ip(t.getUint32(i+11)),o=t.getUint16(i+15);e.push({id:n,nickname:a,remoteAddress:r,latency:o}),i+=s}this.emit("users",e);break}case 1:this.emit("heartbeat",t);break;case 3:{const e=t.getUint8(1).toString(),s=!!t.getUint8(2),i=t.getFloat32(3),n=t.getFloat32(7);this.emit("motion",{id:e,isDown:s,x:i,y:n});break}}};onUsers=t=>{Global.USERS=t,Stage.events.emit(Events.UPDATE,t)};onHeartbeat=t=>{this.connected||(this.connected=!0,this.id=t.getUint8(1).toString(),this.nickname()),this.send(t)};nickname=()=>{const t=this.views[2];t.setUint8(0,2);const e=this.encoder.encode(Global.NICKNAME);for(let s=0;s<10;s++)t.setUint8(2+s,e[s]);this.send(t)};motion=({isDown:t,x:e,y:s})=>{const i=this.views[3];i.setUint8(0,3),i.setUint8(2,t?1:0),i.setFloat32(3,e),i.setFloat32(7,s),this.send(i)};send=t=>{this.connected&&this.socket.send(t.buffer)};connect=()=>{this.socket&&this.close(),this.socket=new WebSocket(this.server,["permessage-deflate"]),this.socket.binaryType="arraybuffer",this.addListeners()};close=()=>{this.removeListeners(),clearTween(this.timeout),this.socket.close()}}class Data{static init(){this.Socket=new Socket}static getUser=t=>{for(let e=0,s=Global.USERS.length;e<s;e++)if(Global.USERS[e].id===t)return Global.USERS[e];return null}}class ProgressCanvas extends Interface{constructor(){super(null,"canvas");this.width=32,this.height=32,this.x=16,this.y=16,this.radius=12.8,this.startAngle=radians(-90),this.progress=0,this.needsUpdate=!1,this.initCanvas()}initCanvas(){this.context=this.element.getContext("2d")}addListeners(){ticker.add(this.onUpdate)}removeListeners(){ticker.remove(this.onUpdate)}onUpdate=()=>{this.needsUpdate&&this.update()};onProgress=({progress:t})=>{clearTween(this),this.needsUpdate=!0,tween(this,{progress:t},500,"easeOutCubic",(()=>{this.needsUpdate=!1,this.progress>=1&&this.onComplete()}))};onComplete=()=>{this.removeListeners(),this.events.emit(Events.COMPLETE)};resize=()=>{this.element.width=Math.round(2*this.width),this.element.height=Math.round(2*this.height),this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",this.context.scale(2,2),this.context.lineWidth=1.5,this.context.strokeStyle=Stage.rootStyle.getPropertyValue("--main-color").trim(),this.update()};update=()=>{this.context.clearRect(0,0,this.element.width,this.element.height),this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,this.startAngle,this.startAngle+radians(360*this.progress)),this.context.stroke()};animateIn=()=>{this.addListeners(),this.resize()};animateOut=()=>{this.tween({scale:1.1,opacity:0},400,"easeInCubic")};destroy=()=>(this.removeListeners(),clearTween(this),super.destroy())}class PreloaderView extends Interface{constructor(){super(".preloader"),this.initHTML(),this.initView(),this.addListeners()}initHTML(){this.css({left:0,top:0,width:"100%",height:"100%",backgroundColor:"var(--main-bg-color)",zIndex:100,pointerEvents:"none",webkitUserSelect:"none",userSelect:"none"})}initView(){this.view=new ProgressCanvas,this.view.css({left:"50%",top:"50%",marginLeft:-this.view.width/2,marginTop:-this.view.height/2}),this.add(this.view)}addListeners(){this.view.events.on(Events.COMPLETE,this.onComplete)}removeListeners(){this.view.events.off(Events.COMPLETE,this.onComplete)}onProgress=t=>{this.view.onProgress(t)};onComplete=()=>{this.events.emit(Events.COMPLETE)};animateIn=()=>{this.view.animateIn()};animateOut=()=>(this.view.animateOut(),this.tween({opacity:0},250,"easeOutSine",500));destroy=()=>(this.removeListeners(),super.destroy())}class Preloader{static init(){if(!Device.webgl)return location.href="fallback.html";Assets.cache=!0,Data.init(),Data.Socket.init(),this.initView(),this.initLoader(),this.addListeners()}static initView(){this.view=new PreloaderView,Stage.add(this.view)}static async initLoader(){this.view.animateIn(),this.loader=new MultiLoader,this.loader.load(new FontLoader([{family:"D-DIN",style:"normal",weight:"400"},{family:"Gothic A1",style:"normal",weight:"500"},{family:"Gothic A1",style:"normal",weight:"700"},{family:"Roboto Mono",style:"normal",weight:"500"}])),this.loader.load(new AssetLoader(Config.ASSETS)),this.loader.add(1);const{App:t}=await import("./app.js");this.loader.trigger(1),this.app=t,await this.app.init(this.loader)}static addListeners(){this.loader.events.on(Events.PROGRESS,this.view.onProgress),this.view.events.on(Events.COMPLETE,this.onComplete),Stage.element.addEventListener("pointerdown",this.onPointerDown)}static removeListeners(){this.loader.events.off(Events.PROGRESS,this.view.onProgress),this.view.events.off(Events.COMPLETE,this.onComplete),Stage.element.removeEventListener("pointerdown",this.onPointerDown)}static onComplete=async()=>{this.removeListeners(),this.loader=this.loader.destroy(),await this.view.animateOut(),this.view=this.view.destroy(),this.app.start()};static onPointerDown=()=>{Stage.element.removeEventListener("pointerdown",this.onPointerDown),WebAudio.resume()}}export{Assets,Config,Data,Device,Events,Global,Interface,Preloader,Stage,WebAudio,basename,clamp,clearTween,shuffle,ticker,tween,wait};
